

```{sh compile_or_install_if_needed}
cargo install --path .
cargo install --path ../data-beans
```

```{sh download_10x_data}
[ -f Xenium_V1_human_Pancreas_FFPE_outs.zip ] || \
	curl -O https://cf.10xgenomics.com/samples/xenium/2.0.0/Xenium_V1_human_Pancreas_FFPE/Xenium_V1_human_Pancreas_FFPE_outs.zip
if ! [ -d temp ] ; then
	mkdir -p temp
	unzip Xenium_V1_human_Pancreas_FFPE_outs.zip -d ./temp
fi

## create temporary files
[ -f temp7.h5 ] || data-beans from-zarr temp/cell_feature_matrix.zarr.zip -o temp7 --backend hdf5
```

```{sh run_pinto_svd}
pinto svd temp7.h5 -c temp/cells.parquet --coord-column-names x_centroid,y_centroid -o temp7 --preload-data
```

```{r}
library(dplyr)
library(data.table)
library(ggplot2)

.dt <- arrow::read_parquet("temp/cells.parquet") %>% as.data.table
.prop <- arrow::read_parquet("temp7.propensity.parquet") %>%
    as.data.table %>%
    melt(id.vars = "row") %>%
    rename(cell_id = row)

.dt.show <- .prop %>%
    left_join(.dt[, .(cell_id, x_centroid, y_centroid, total_counts)]) %>%
    na.omit() %>%
    filter(value > .5)

ggplot(.dt.show[sample(.N)],
       aes(x_centroid, y_centroid, fill=variable, size=value)) +
    theme_void() +
    geom_point(stroke=0.1,pch=21,colour="gray") +
    scale_fill_brewer(palette="Paired", guide="none") +
    scale_size_continuous(range=c(0,1.5), guide="none")

```


```{r}


```


